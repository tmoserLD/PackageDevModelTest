<?xml version="1.0" encoding="UTF-8"?>
<ValidationRule xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>Closed_must_be_Closed</fullName>
    <active>true</active>
    <description>Prevent forecast category of &apos;closed&apos; to be selected if opportunity is open</description>
    <errorConditionFormula>AND(contains($Profile.Name, &quot;Sales&quot;),
NOT(ISPICKVAL( Type , &quot;Trial&quot;)),

OR(
AND(ISPICKVAL(StageName,&quot;3 - Present Solution&quot;), TEXT(Forecast__c) = &quot;Omitted&quot;), 
AND(ISPICKVAL(StageName,&quot;3 - Present Solution&quot;), isblank(Text(Forecast__c))), 
AND(ISPICKVAL(StageName,&quot;1 - Qualify Opportunity&quot;), TEXT(Forecast__c) = &quot;Closed&quot;), 
AND(ISPICKVAL(StageName,&quot;2 - Develop Opportunity&quot;), TEXT(Forecast__c) = &quot;Closed&quot;), 
AND(ISPICKVAL(StageName,&quot;3 - Present Solution&quot;), TEXT(Forecast__c) = &quot;Closed&quot;), 
AND(ISPICKVAL(StageName,&quot;4 - Close Opportunity&quot;), TEXT(Forecast__c) = &quot;Closed&quot;)

))</errorConditionFormula>
    <errorDisplayField>Forecast__c</errorDisplayField>
    <errorMessage>Forecast category needs to be updated, or a value of &quot;Closed&quot; is not acceptable for an open opportunity.</errorMessage>
</ValidationRule>
